var QAPrompt=function(){};$.extend(QAPrompt.prototype,{options:null,pDialog:null,eventListenrs:null,interval:null,initialize:function(b){this.options=$.extend({placeIn:document.body,sibling:null},b);this.createElement();var a=this;this.updatePos();this.interval=window.setInterval(function(){a.updatePos()},1000);return this},updatePos:function(){var a=$(this.options.sibling).offset();this.pDialog.css({position:"absolute",top:a.top+$(this.options.sibling).outerHeight()+"px",left:a.left+"px"})},createElement:function(){this.pDialog=$("<div>").addClass("prompt-dialog").append($("<div>").addClass("prompt-content"));$(".prompt-content",this.pDialog).append(this.options.element);$(this.options.placeIn).append(this.pDialog);if(!!this.options.sibling){this.updatePos()}this.pDialog.hide();var a=this;this.pDialog.fadeIn(400,function(){a.addEventListeners()})},addEventListeners:function(){var a=this;$(document.body).bind("click.qaprompt",function(){a.destroy()});$(this.pDialog).bind("click.qaprompt",function(b){b.stopPropagation()})},destroy:function(){$(document.body).unbind(".qaprompt");$(this.pDialog).unbind(".qaprompt");window.clearInterval(this.interval);var a=this;this.pDialog.fadeOut(400,function(){a.pDialog.remove();a.pDialog=null;a.eventListenrs=null;a.options=null})}});var BangMenu=function(){};$.extend(BangMenu.prototype,{options:null,current:null,timer:null,initialize:function(a){if(!a.menu){throw"Menu can not be null."}this.options=$.extend({timeout:300},a);$("UL",$(this.options.menu)).css("visibility","hidden");this.addEventListeners()},addEventListeners:function(){var a=this;$(">li",$(this.options.menu)).each(function(b,c){$(c).bind("mouseover",function(d){a._open(this)}).bind("mouseout",function(d){a._close(this)}).bind("click",function(d){a._close_now(this)})})},_open:function(a){this._close_pre(a);this.current=a;this._clear();this.timer=window.setTimeout(function(){$(a).addClass("menuselected");$("UL",a).css("visibility","visible")},this.options.timeout)},_close:function(a){this._clear();var b=this;this.timer=window.setTimeout(function(){b._close_now(a)},this.options.timeout)},_close_now:function(a){$(a).removeClass("menuselected");$("UL",a).css("visibility","hidden")},_close_pre:function(a){if(!!this.current&&a!=this.current){this._close_now(this.current);this.current=null;this._clear()}},_clear:function(){window.clearTimeout(this.timer)}});function create_captcha_refresh_btn(){document.write('<a class="captcha-refresh-btn" href="javascript:refresh_captcha(this);">看不清？换一幅</a>')}function refresh_captcha(a){if(0==$("#id_captcha_0").length){return}var b=$("#id_captcha_0")[0].value;$.ajax({url:"/accounts/captcha/"+b+"/refresh/",type:"GET",cache:false,dataType:"json",success:function(c){$("#id_captcha_0")[0].value=c.key;$("IMG.captcha",a.parentNode)[0].src="/captcha/image/"+c.key+"/"}})}function escapeHTML(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function ajaxImageUpload(b,c,e,a,d){$(a).ajaxStart(function(){$(this).show()}).ajaxComplete(function(){$(this).hide()});$.ajaxFileUpload({url:"/upload/image/",secureuri:false,fileElementId:e,dataType:"xml",success:function(h,f){var g=$(h).find("file_url").text();var i=$(h).find("file").text();var f=$(h).find("status").text();if(f!="200"){alert($(h).find("msg").text())}else{if(g.indexOf("http://")==0){$(b).attr("value",g)}else{$(b).attr("value","http://"+(!d?document.location.host:d)+g)}$(c).attr("value",$(c).attr("value")+i+",")}},error:function(g,f,h){alert(h)}});return false};